-- Script to normalize the user_home table into separate tables for users and homes with a junction table for relationships.

-- Use the existing database
USE home_db;

-- Disable foreign key checks for table alterations
SET FOREIGN_KEY_CHECKS = 0;

-- -- Drop existing tables if they exist
-- DROP TABLE IF EXISTS `user_home`;
-- DROP TABLE IF EXISTS `user`;
-- DROP TABLE IF EXISTS `home`;
-- DROP TABLE IF EXISTS `user_home_relationship`;

-- Create the `user` table to store user attributes
CREATE TABLE `user` (
    `id` INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    `username` VARCHAR(100) NOT NULL UNIQUE,
    `email` VARCHAR(100) NOT NULL UNIQUE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
-- Create the `home` table to store home attributes
CREATE TABLE `home` (
    `id` INT AUTO_INCREMENT PRIMARY KEY,
    `street_address` VARCHAR(255) NOT NULL UNIQUE,
    `state` VARCHAR(50),
    `zip` VARCHAR(10),
    `sqft` FLOAT,
    `beds` INT,
    `baths` INT,
    `list_price` FLOAT
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

-- Create the `user_home_relationship` table to manage the many-to-many relationship with an `id` primary key
CREATE TABLE `user_home_relationship` (
    `id` INT AUTO_INCREMENT PRIMARY KEY,
    `username` VARCHAR(100),
    `home_id` INT,
    FOREIGN KEY (`username`) REFERENCES `user`(`username`) ON DELETE CASCADE,
    FOREIGN KEY (`home_id`) REFERENCES `home`(`id`) ON DELETE CASCADE,
    UNIQUE KEY `unique_user_home` (`username`, `home_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;


-- Insert user data
INSERT INTO `user` (`username`, `email`) VALUES
    ('user1', 'user1@example.org'),
    ('user7', 'user7@example.org'),
    ('user3', 'user3@example.org'),
    ('user10', 'user10@example.org'),
    ('user6', 'user6@example.org'),
    ('user2', 'user2@example.org'),
    ('user5', 'user5@example.org'),
    ('user4', 'user4@example.org'),
    ('user9', 'user9@example.org'),
    ('user8', 'user8@example.org'),
    ('user11', 'user11@example.org'),
    ('user12', 'user12@example.org'),
    ('user13', 'user13@example.org'),
    ('user14', 'user14@example.org'),
    ('user15', 'user15@example.org'),
    ('user16', 'user16@example.org'),
    ('user17', 'user17@example.org'),
    ('user18', 'user18@example.org'),
    ('user19', 'user19@example.org'),
    ('user20', 'user20@example.org'),
    ('user21', 'user21@example.org'),
    ('user22', 'user22@example.org'),
    ('user23', 'user23@example.org'),
    ('user24', 'user24@example.org'),
    ('user25', 'user25@example.org'),
    ('user26', 'user26@example.org'),
    ('user27', 'user27@example.org'),
    ('user28', 'user28@example.org'),
    ('user29', 'user29@example.org'),
    ('user30', 'user30@example.org');

-- Insert home data
INSERT INTO `home` (`street_address`, `state`, `zip`, `sqft`, `beds`, `baths`, `list_price`) VALUES
    ('72242 Jacobson Square', 'Arizona', '05378', 2945.89, 1, 3, 791204),
    ('75246 Cumberland Street', 'Arizona', '08229', 2278.71, 2, 1, 182092),
    ('811 Walker-Bogan Terrace', 'Rhode Island', '19219', 3648.42, 1, 2, 964995),
    ('947 Allen Motorway', 'Massachusetts', '65353', 1375.37, 3, 3, 578532),
    ('7976 W Division Street', 'New Mexico', '99460', 2510.57, 1, 3, 842529),
    ('4679 Horacio Plains', 'Texas', '62631', 1679.69, 6, 3, 303195),
    ('78089 Prospect Avenue', 'Nebraska', '95406', 4718.9, 1, 2, 358752),
    ('5788 Mallie Gateway', 'Nebraska', '37697', 2236.85, 3, 2, 632165),
    ('975 Marty Ridges', 'New Jersey', '28721', 1310.08, 6, 3, 467656),
    ('40353 Main Street S', 'West Virginia', '77945', 3480.32, 2, 3, 263753),
    ('9919 Park Drive', 'Maine', '68269', 1773.54, 3, 2, 329301),
    ('642 Aaron Parkway', 'Maine', '69309', 1260.51, 4, 3, 883444),
    ('529 S Chestnut Street', 'Wyoming', '68181', 3571.47, 2, 1, 102264),
    ('4218 Louvenia Street', 'Ohio', '94585', 2336.27, 2, 2, 250682),
    ('9905 Rolfson Burgs', 'Kansas', '02468', 4464.5, 5, 2, 178178),
    ('7816 Depot Street', 'Iowa', '93347', 963.04, 1, 2, 383454),
    ('125 4th Street', 'North Dakota', '86965', 3758.22, 4, 1, 299997),
    ('592 N Pine Street', 'West Virginia', '35608', 2559.48, 5, 1, 130775),
    ('93346 Hoyt Trafficway', 'Maine', '34630', 1576.53, 5, 2, 113377),
    ('244 Lorenzo Expressway', 'Utah', '81773', 4911.86, 1, 1, 789123),
    ('456 Elm Street', 'California', '90210', 3500.00, 4, 3, 900000),
    ('789 Pine Road', 'Oregon', '97201', 2750.00, 3, 2, 450000),
    ('123 Maple Avenue', 'Washington', '98101', 3200.00, 4, 2, 500000),
    ('345 Oak Lane', 'Colorado', '80202', 1800.00, 2, 1, 250000),
    ('678 Birch Boulevard', 'Nevada', '89101', 2200.00, 3, 2, 350000),
    ('123 Elm St', 'California', '90001', 1200, 3, 2, 500000),
    ('456 Oak St', 'California', '90002', 1400, 3, 2, 550000),
    ('789 Maple St', 'Texas', '73301', 1600, 4, 3, 600000),
    ('101 Pine St', 'Texas', '73302', 1800, 4, 3, 650000),
    ('202 Birch St', 'New York', '10001', 1100, 2, 2, 450000),
    ('303 Cedar St', 'New York', '10002', 1500, 3, 2, 580000),
    ('404 Spruce St', 'Florida', '32003', 1700, 4, 3, 620000),
    ('505 Walnut St', 'Florida', '32004', 1900, 5, 4, 670000),
    ('606 Chestnut St', 'Washington', '98001', 1400, 3, 2, 560000),
    ('707 Sycamore St', 'Washington', '98002', 1600, 4, 3, 610000),
    ('808 Poplar St', 'Nevada', '89501', 1300, 3, 2, 540000),
    ('909 Willow St', 'Nevada', '89502', 1800, 4, 3, 680000),
    ('1001 Fir St', 'Colorado', '80001', 1200, 2, 2, 460000),
    ('1102 Ash St', 'Colorado', '80002', 1900, 5, 4, 700000),
    ('1203 Palm St', 'Arizona', '85001', 1400, 3, 2, 590000),
    ('1304 Redwood St', 'Arizona', '85002', 1700, 4, 3, 640000),
    ('1405 Cypress St', 'Oregon', '97001', 1600, 4, 3, 600000),
    ('1506 Hickory St', 'Oregon', '97002', 1300, 3, 2, 530000),
    ('1607 Dogwood St', 'Nevada', '89503', 1400, 3, 2, 550000),
    ('1708 Magnolia St', 'Texas', '73303', 1800, 4, 3, 660000),
    ('1809 Hawthorn St', 'New York', '10003', 1500, 3, 2, 610000),
    ('1900 Juniper St', 'Florida', '32005', 1700, 4, 3, 620000),
    ('2001 Alder St', 'Washington', '98003', 1600, 4, 3, 620000),
    ('2102 Sequoia St', 'Arizona', '85003', 1400, 3, 2, 570000),
    ('2203 Larch St', 'California', '90003', 1800, 4, 3, 630000);

-- Insert relationships between users and homes with the new `id` primary key
-- Inserting more data into the user_home_relationship table
INSERT INTO `user_home_relationship` (`username`, `home_id`) VALUES
-- User 1
('user1', 1),
('user1', 2),

-- User 2
('user2', 1),
('user2', 3),
('user2', 4),

-- User 3
('user3', 2),
('user3', 3),
('user3', 5),

-- User 4
('user4', 4),
('user4', 6),

-- User 5
('user5', 5),
('user5', 6),
('user5', 7),

-- User 6
('user6', 7),
('user6', 8),

-- User 7
('user7', 8),
('user7', 9),

-- User 8
('user8', 9),
('user8', 10),
('user8', 11),

-- User 9
('user9', 10),
('user9', 11),
('user9', 12),

-- User 10
('user10', 12),
('user10', 13),

-- User 11
('user11', 13),
('user11', 14),

-- User 12
('user12', 14),
('user12', 15),

-- User 13
('user13', 26),
('user13', 27),
('user13', 28),
('user13', 29),
('user13', 30),
('user13', 31),
('user13', 32),
('user13', 33),
('user13', 34),
('user13', 35),
('user13', 36),
('user13', 37),
('user13', 38),
('user13', 39),
('user13', 40),
('user13', 41),
('user13', 42),
('user13', 43),
('user13', 44),
('user13', 45),

-- User 14
('user14', 26),
('user14', 28),
('user14', 30),
('user14', 31),
('user14', 33),
('user14', 35),
('user14', 37),
('user14', 39),
('user14', 41),
('user14', 43),
('user14', 45),
('user14', 46),
('user14', 47),
('user14', 48),
('user14', 49),
('user14', 50),
('user14', 27),
('user14', 29),
('user14', 32),
('user14', 36),

-- User 15
('user15', 26),
('user15', 27),
('user15', 28),
('user15', 29),
('user15', 30),
('user15', 31),
('user15', 32),
('user15', 33),
('user15', 34),
('user15', 35),
('user15', 36),
('user15', 37),
('user15', 38),
('user15', 39),
('user15', 40),
('user15', 41),
('user15', 42),
('user15', 43),
('user15', 44),
('user15', 45),

-- User 16
('user16', 26),
('user16', 28),
('user16', 30),
('user16', 31),
('user16', 33),
('user16', 35),
('user16', 37),
('user16', 39),
('user16', 41),
('user16', 43),
('user16', 45),
('user16', 47),
('user16', 48),
('user16', 49),
('user16', 50),
('user16', 27),
('user16', 29),
('user16', 32),
('user16', 34),
('user16', 46),

-- User 17
('user17', 26),
('user17', 27),
('user17', 28),
('user17', 29),
('user17', 30),
('user17', 31),
('user17', 32),
('user17', 33),
('user17', 34),
('user17', 35),
('user17', 36),
('user17', 37),
('user17', 38),
('user17', 39),
('user17', 40),
('user17', 41),
('user17', 42),
('user17', 43),
('user17', 44),
('user17', 45),

-- User 18
('user18', 26),
('user18', 27),
('user18', 28),
('user18', 29),
('user18', 30),
('user18', 31),
('user18', 32),
('user18', 33),
('user18', 34),
('user18', 35),
('user18', 36),
('user18', 37),
('user18', 38),
('user18', 39),
('user18', 40),
('user18', 41),
('user18', 42),
('user18', 43),
('user18', 44),
('user18', 45),

-- User 19
('user19', 26),
('user19', 28),
('user19', 30),
('user19', 31),
('user19', 33),
('user19', 35),
('user19', 37),
('user19', 39),
('user19', 41),
('user19', 43),
('user19', 45),
('user19', 46),
('user19', 47),
('user19', 48),
('user19', 49),
('user19', 50),
('user19', 27),
('user19', 29),
('user19', 32),
('user19', 36),

-- User 20
('user20', 26),
('user20', 27),
('user20', 28),
('user20', 29),
('user20', 30),
('user20', 31),
('user20', 32),
('user20', 33),
('user20', 34),
('user20', 35),
('user20', 36),
('user20', 37),
('user20', 38),
('user20', 39),
('user20', 40),
('user20', 41),
('user20', 42),
('user20', 43),
('user20', 44),
('user20', 45),

-- Continue the same pattern for users 21 to 30
('user21', 26),
('user21', 27),
('user21', 28),
('user21', 29),
('user21', 30),
('user21', 31),
('user21', 32),
('user21', 33),
('user21', 34),
('user21', 35),
('user21', 36),
('user21', 37),
('user21', 38),
('user21', 39),
('user21', 40),
('user21', 41),
('user21', 42),
('user21', 43),
('user21', 44),
('user21', 45),

('user22', 26),
('user22', 27),
('user22', 28),
('user22', 29),
('user22', 30),
('user22', 31),
('user22', 32),
('user22', 33),
('user22', 34),
('user22', 35),
('user22', 36),
('user22', 37),
('user22', 38),
('user22', 39),
('user22', 40),
('user22', 41),
('user22', 42),
('user22', 43),
('user22', 44),
('user22', 45),
('user23', 26),
('user23', 27),
('user23', 28),
('user23', 29),
('user23', 30),
('user23', 31),
('user23', 32),
('user23', 33),
('user23', 34),
('user23', 35),
('user23', 36),
('user23', 37),
('user23', 38),
('user23', 39),
('user23', 40),
('user23', 41),
('user23', 42),
('user23', 43),
('user23', 44),
('user23', 45),

-- User 24
('user24', 26),
('user24', 28),
('user24', 30),
('user24', 31),
('user24', 33),
('user24', 35),
('user24', 37),
('user24', 39),
('user24', 41),
('user24', 43),
('user24', 45),
('user24', 46),
('user24', 47),
('user24', 48),
('user24', 49),
('user24', 50),
('user24', 27),
('user24', 29),
('user24', 32),
('user24', 36),

-- User 25
('user25', 26),
('user25', 27),
('user25', 28),
('user25', 29),
('user25', 30),
('user25', 31),
('user25', 32),
('user25', 33),
('user25', 34),
('user25', 35),
('user25', 36),
('user25', 37),
('user25', 38),
('user25', 39),
('user25', 40),
('user25', 41),
('user25', 42),
('user25', 43),
('user25', 44),
('user25', 45),

-- User 26
('user26', 26),
('user26', 28),
('user26', 30),
('user26', 31),
('user26', 33),
('user26', 35),
('user26', 37),
('user26', 39),
('user26', 41),
('user26', 43),
('user26', 45),
('user26', 47),
('user26', 48),
('user26', 49),
('user26', 50),
('user26', 27),
('user26', 29),
('user26', 32),
('user26', 34),
('user26', 36),

-- User 27
('user27', 26),
('user27', 27),
('user27', 28),
('user27', 29),
('user27', 30),
('user27', 31),
('user27', 32),
('user27', 33),
('user27', 34),
('user27', 35),
('user27', 36),
('user27', 37),
('user27', 38),
('user27', 39),
('user27', 40),
('user27', 41),
('user27', 42),
('user27', 43),
('user27', 44),
('user27', 45),

-- User 28
('user28', 26),
('user28', 27),
('user28', 28),
('user28', 29),
('user28', 30),
('user28', 31),
('user28', 32),
('user28', 33),
('user28', 34),
('user28', 35),
('user28', 36),
('user28', 37),
('user28', 38),
('user28', 39),
('user28', 40),
('user28', 41),
('user28', 42),
('user28', 43),
('user28', 44),
('user28', 45),

-- User 29
('user29', 26),
('user29', 28),
('user29', 30),
('user29', 31),
('user29', 33),
('user29', 35),
('user29', 37),
('user29', 39),
('user29', 41),
('user29', 43),
('user29', 45),
('user29', 46),
('user29', 47),
('user29', 48),
('user29', 49),
('user29', 50),
('user29', 27),
('user29', 29),
('user29', 32),
('user29', 36),

-- User 30
('user30', 26),
('user30', 27),
('user30', 28),
('user30', 29),
('user30', 30),
('user30', 31),
('user30', 32),
('user30', 33),
('user30', 34),
('user30', 35),
('user30', 36),
('user30', 37),
('user30', 38),
('user30', 39),
('user30', 40),
('user30', 41),
('user30', 42),
('user30', 43),
('user30', 44),
('user30', 45);

-- Ensure that there are no duplicate entries
-- Note: The UNIQUE KEY constraint on (username, home_id) will ensure this


-- Enable foreign key checks
SET FOREIGN_KEY_CHECKS = 1;

-- End of script
